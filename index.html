<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP Login</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
</head>
<body>
    <h1>OTP Login</h1>
    <div id="login-container">
        <input type="text" id="phone-number" placeholder="Enter your phone number" />
        <button id="send-otp">Send OTP</button>
        <div id="otp-container" style="display: none;">
            <input type="text" id="otp" placeholder="Enter OTP" />
            <button id="verify-otp">Verify OTP</button>
        </div>
    </div>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCtyvIJL5xVdMG0HznaMkeChF3lSMxF20c",
            authDomain: "rj-services-83743.firebaseapp.com",
            projectId: "rj-services-83743",
            storageBucket: "rj-services-83743.appspot.com",
            messagingSenderId: "947044086169",
            appId: "1:947044086169:web:86c96ff9f801798456a308",
            measurementId: "G-XTKK72MRCV"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // Function to send OTP
        document.getElementById('send-otp').addEventListener('click', function() {
            const phoneNumber = document.getElementById('phone-number').value;
            const appVerifier = new firebase.auth.RecaptchaVerifier('send-otp', {
                'size': 'invisible',
                'callback': (response) => {
                    // reCAPTCHA solved, allow send OTP
                    sendOtp(phoneNumber);
                }
            });
            appVerifier.verify().then(() => {
                sendOtp(phoneNumber);
            }).catch((error) => {
                console.error("reCAPTCHA verification failed:", error);
            });
        });

        function sendOtp(phoneNumber) {
            auth.signInWithPhoneNumber(phoneNumber, appVerifier)
                .then((confirmationResult) => {
                    // SMS sent. Prompt user to enter the code from the message
                    window.confirmationResult = confirmationResult;
                    document.getElementById('otp-container').style.display = 'block';
                    alert('OTP sent!');
                }).catch((error) => {
                    console.error("Error during signInWithPhoneNumber", error);
                });
        }

        // Function to verify OTP
        document.getElementById('verify-otp').addEventListener('click', function() {
            const otp = document.getElementById('otp').value;
            window.confirmationResult.confirm(otp).then((result) => {
                // User signed in successfully.
                const user = result.user;
                alert("User signed in successfully: " + user.phoneNumber);
                window.location.href = 'index1.html'; // Redirect to another page after successful login
            }).catch((error) => {
                console.error("Error verifying OTP", error);
                alert("Invalid OTP. Please try again.");
            });
        });
    </script>
</body>
</html>
