<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            color: #333;
            padding: 20px;
        }
        .container {
            max-width: 400px;
            margin: auto;
            background: #febd69;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            color: #d97706;
        }
        input[type="text"], input[type="date"], input[type="file"], textarea {
            width: 90%;
            padding: 10px;
            margin: 10px auto;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: block;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #d97706;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #febd69;
        }
        .profile-display {
            margin-top: 20px;
            padding: 10px;
            background-color: #ffffff;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }
        .profile-display img {
            max-width: 100%;
            border-radius: 5px;
        }
        .edit-btn {
            background-color: #febd69;
            color: #333;
        }
        .edit-btn:hover {
            background-color: #d97706;
            color: white;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCtyvIJL5xVdMG0HznaMkeChF3lSMxF20c",
            authDomain: "rj-services-83743.web.app",
            projectId: "rj-services-83743",
            storageBucket: "rj-services-83743.appspot.com",
            messagingSenderId: "947044086169",
            appId: "1:947044086169:web:86c96ff9f801798456a308",
            measurementId: "G-XTKK72MRCV"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        // Function to save profile data to Firebase
        function saveProfile() {
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const dob = document.getElementById('dob').value;
            const bio = document.getElementById('bio').value;
            const profileImage = document.getElementById('profileImage').files[0];

            const userId = Date.now(); // Unique user ID based on timestamp

            // Save profile data to Firebase Realtime Database
            database.ref('profiles/' + userId).set({
                name: name,
                email: email,
                phone: phone,
                address: address,
                dob: dob,
                bio: bio
            }).then(() => {
                console.log("Profile data saved successfully");

                // Only upload the profile image if one is selected
                if (profileImage) {
                    const storageRef = storage.ref('profileImages/' + userId + '/' + profileImage.name);
                    storageRef.put(profileImage).then(() => {
                        console.log("Profile image uploaded successfully");
                        return storageRef.getDownloadURL(); // Get the download URL
                    }).then((url) => {
                        return database.ref('profiles/' + userId).update({ profileImage: url });
                    }).then(() => {
                        console.log("Profile image URL saved successfully");
                        displayProfile(userId); // Display profile after saving
                    }).catch((error) => {
                        console.error("Error uploading profile image: ", error);
                    });
                } else {
                    displayProfile(userId); // Display profile if no image is selected
                }
            }).catch((error) => {
                console.error("Error saving profile: ", error);
            });
        }

        // Function to display profile data
        function displayProfile(userId) {
            database.ref('profiles/' + userId).once('value').then((snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById('displayName').textContent = data.name;
                    document.getElementById('displayEmail').textContent = data.email;
                    document.getElementById('displayPhone').textContent = data.phone;
                    document.getElementById('displayAddress').textContent = data.address;
                    document.getElementById('displayDob').textContent = data.dob;
                    document.getElementById('displayBio').textContent = data.bio;

                    if (data.profileImage) {
                        const displayImage = document.getElementById('displayImage');
                        displayImage.src = data.profileImage;
                        displayImage.style.display = 'block'; // Show the image
                    }
                    document.getElementById('profileDisplay').style.display = 'block'; // Show profile section
                    document.getElementById('profileForm').style.display = 'none'; // Hide profile form
                    document.getElementById('editProfileBtn').style.display = 'inline-block'; // Show edit button
                }
            }).catch((error) => {
                console.error("Error displaying profile: ", error);
            });
        }

        // Function to edit profile data
        function editProfile() {
            document.getElementById('profileForm').reset(); // Reset the form
            document.getElementById('profileForm').style.display = 'block'; // Show profile form
            document.getElementById('profileDisplay').style.display = 'none'; // Hide profile display
            document.getElementById('editProfileBtn').style.display = 'none'; // Hide edit button
        }

        // Clear local storage and display profile data if available on page load
        window.onload = function() {
            localStorage.clear(); // Clear local storage on page load
        };

        document.getElementById('saveProfileBtn').addEventListener('click', saveProfile);
        document.getElementById('editProfileBtn').addEventListener('click', editProfile);
    </script>
</head>
<body>

<div class="container">
    <h2>User Profile</h2>

    <!-- User Profile Form -->
    <div id="profileForm">
        <input type="text" id="name" placeholder="Enter Name" required>
        <input type="text" id="email" placeholder="Enter Email" required>
        <input type="text" id="phone" placeholder="Enter Phone Number" required>
        <input type="text" id="address" placeholder="Enter Address" required>
        <input type="date" id="dob" required>
        <textarea id="bio" placeholder="Enter Bio"></textarea>
        <input type="file" id="profileImage">
        <button id="saveProfileBtn">Save Profile</button>
    </div>

    <!-- Profile Display Section -->
    <div id="profileDisplay" class="profile-display" style="display: none;">
        <h3>Profile Details</h3>
        <p><strong>Name:</strong> <span id="displayName"></span></p>
        <p><strong>Email:</strong> <span id="displayEmail"></span></p>
        <p><strong>Phone:</strong> <span id="displayPhone"></span></p>
        <p><strong>Address:</strong> <span id="displayAddress"></span></p>
        <p><strong>Date of Birth:</strong> <span id="displayDob"></span></p>
        <p><strong>Bio:</strong> <span id="displayBio"></span></p>
        <img id="displayImage" src="" alt="Profile Image" style="display:none;">
        <button id="editProfileBtn" class="edit-btn" style="display: none;">Edit Profile</button>
    </div>
</div>

</body>
</html>
